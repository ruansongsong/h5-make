(function($){var defaultOpts={dropArea:"#upload-area",success:false,error:false,url:"/upload-file",fileHandler:"#fileHandler"};var ZUpload=function(options){this.options=$.extend({},defaultOpts,options);this.init()};ZUpload.prototype={init:function(){this.area=$(this.options.dropArea);this.clearDefault();this.bindOnDrop();this.bindFileInput()},clearDefault:function(){$(document).on({dragleave:function(e){e.preventDefault()},drop:function(e){e.preventDefault()},dragenter:function(e){e.preventDefault()},dragover:function(e){e.preventDefault()}})},bindOnDrop:function(){var self=this;var areaItem=self.area[0];areaItem.addEventListener("drop",function(e){e.preventDefault();var fileList=e.dataTransfer.files;if(fileList.length==0){return false}if(fileList[0].type.indexOf("image")===-1){console.log("您拖的不是图片！");return false}self.upload(fileList[0])})},upload:function(file){var self=this;var formData=new FormData();formData.append("file",file);$.ajax({url:self.options.url,type:"POST",cache:false,data:formData,processData:false,contentType:false}).done(function(res){var obj=JSON.parse(res);self.preview(obj.data.filePath);self.options.success&&self.options.success(obj)}).fail(function(res){self.options.error&&self.options.error(success)})},bindFileInput:function(){var self=this;var handler=$(self.options.fileHandler);var fileInput=$('<input type="file" class="file-input"></input>');fileInput.css({display:"none"});handler.parent("div").append(fileInput);handler.on("click",function(){handler.parent("div").children(".file-input").trigger("click")});fileInput.on("change",function(){self.upload($(this)[0].files[0])})},preview:function(filePath){var self=this;var area=this.area;area.children(".imageWrap").remove();var image=new Image();image.src=filePath;image.height=area.height()-2;var imageWrap=$('<div class="imageWrap"> </div>');imageWrap.css({"position":"absolute","text-align":"center","top":"0","left":"0","width":"100%","height":"100%","z-index":"99"});imageWrap.append(image);area.append(imageWrap)},clear:function(){this.area.children(".imageWrap").remove()}};window.ZUpload=ZUpload})(jQuery);