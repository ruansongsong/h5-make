(function($){var defaultOpts={stage:document,itemClass:"resize-item",onTriggerItem:false,onHideItem:false,onDrag:false};var ZResize=function(options){this.options=$.extend({},defaultOpts,options);this.init()};ZResize.prototype={init:function(){this.initResizeBox()},initResizeBox:function(){var self=this;$("."+self.options.itemClass).each(function(){self.createResizePanel($(this))});self.bindHidePanel()},addResizeItem:function(){var self=this;var stage=$(self.options.stage);var item=$('<div class="'+self.options.itemClass+'"></div>');stage.append(item);self.createResizePanel(item)},addResizeCapa:function(item){item.addClass(this.options.itemClass);this.createResizePanel(item)},createResizePanel:function(item){var self=this;var width=item.outerWidth();var height=item.outerHeight();var resizePanel=$('<div class="resize-panel"></div>');resizePanel.css({width:width,height:height,top:0,left:0,position:"absolute","background-color":"rgba(0,0,0,0.1)",cursor:"move",display:"none"});self.appendHandler(resizePanel,item);var n=$('<div class="n"></div>');var s=$('<div class="s"></div>');var w=$('<div class="w"></div>');var e=$('<div class="e"></div>');var ne=$('<div class="ne"></div>');var nw=$('<div class="nw"></div>');var se=$('<div class="se"></div>');var sw=$('<div class="sw"></div>');self.addHandlerCss([n,s,w,e,ne,nw,se,sw]);n.css({"top":"-4px","margin-left":"-4px","left":"50%","cursor":"n-resize"});s.css({"bottom":"-4px","margin-left":"-4px","left":"50%","cursor":"s-resize"});e.css({"top":"50%","margin-top":"-4px","right":"-4px","cursor":"e-resize"});w.css({"top":"50%","margin-top":"-4px","left":"-4px","cursor":"w-resize"});ne.css({"top":"-4px","right":"-4px","cursor":"ne-resize"});nw.css({top:"-4px","left":"-4px","cursor":"nw-resize"});se.css({"bottom":"-4px","right":"-4px","cursor":"se-resize"});sw.css({"bottom":"-4px","left":"-4px","cursor":"sw-resize"});self.appendHandler([n,s,w,e,ne,nw,se,sw],resizePanel);self.bindResizeEvent(resizePanel,item);self.bindTrigger(item)},addHandlerCss:function(els){for(var i=0;i<els.length;i++){el=els[i];el.css({position:"absolute",width:"8px",height:"8px",background:"#ff6600",margin:"0"})}},appendHandler:function(handlers,target){for(var i=0;i<handlers.length;i++){el=handlers[i];target.append(el)}},triggerResize:function(el){var self=this;self.options.onTriggerItem&&self.options.onTriggerItem(el);el.siblings("."+self.options.itemClass).removeClass("item-show").children("div").css({display:"none"});el.addClass("item-show").children("div").css({display:"block"})},bindResizeEvent:function(el){var self=this;var ox=0;var oy=0;var ow=0;var oh=0;var oleft=0;var otop=0;var org=el.parent("div");var emove=false;el.on("mousedown",".e",function(e){ox=e.pageX;ow=el.width();emove=true});var smove=false;el.on("mousedown",".s",function(e){oy=e.pageY;oh=el.height();smove=true});var wmove=false;el.on("mousedown",".w",function(e){ox=e.pageX;ow=el.width();wmove=true;oleft=parseInt(org.css("left").replace("px",""))});var nmove=false;el.on("mousedown",".n",function(e){oy=e.pageY;oh=el.height();nmove=true;otop=parseInt(org.css("top").replace("px",""))});var nemove=false;el.on("mousedown",".ne",function(e){ox=e.pageX;oy=e.pageY;ow=el.width();oh=el.height();nemove=true;otop=parseInt(org.css("top").replace("px",""))});var nwmove=false;el.on("mousedown",".nw",function(e){ox=e.pageX;oy=e.pageY;ow=el.width();oh=el.height();otop=parseInt(org.css("top").replace("px",""));oleft=parseInt(org.css("left").replace("px",""));nwmove=true});var semove=false;el.on("mousedown",".se",function(e){ox=e.pageX;oy=e.pageY;ow=el.width();oh=el.height();semove=true});var swmove=false;el.on("mousedown",".sw",function(e){ox=e.pageX;oy=e.pageY;ow=el.width();oh=el.height();swmove=true;oleft=parseInt(org.css("left").replace("px",""))});var drag=false;el.on("mousedown",function(e){ox=e.pageX;oy=e.pageY;otop=parseInt(org.css("top").replace("px",""));oleft=parseInt(org.css("left").replace("px",""));drag=true});$(self.options.stage).on("mousemove",function(e){if(emove){var x=(e.pageX-ox);el.css({width:ow+x});org.css({width:ow+x});self.options.onDrag&&self.options.onDrag(org,{width:ow+x})}else{if(smove){var y=(e.pageY-oy);el.css({height:oh+y});org.css({height:oh+y,"line-height":oh+y+"px"});self.options.onDrag&&self.options.onDrag(org,{height:oh+y})}else{if(wmove){var x=(e.pageX-ox);el.css({width:ow-x,});org.css({width:ow-x,left:oleft+x});self.options.onDrag&&self.options.onDrag(org,{width:ow-x,left:oleft+x})}else{if(nmove){var y=(e.pageY-oy);el.css({height:oh-y});org.css({height:oh-y,top:otop+y,"line-height":oh-y+"px"});self.options.onDrag&&self.options.onDrag(org,{height:oh-y,top:otop+y})}else{if(nemove){var x=e.pageX-ox;var y=e.pageY-oy;el.css({height:oh-y,width:ow+x});org.css({height:oh-y,"line-height":oh-y+"px",top:otop+y,width:ow+x});self.options.onDrag&&self.options.onDrag(org,{height:oh-y,top:otop+y,width:ow+x})}else{if(nwmove){var x=e.pageX-ox;var y=e.pageY-oy;el.css({height:oh-y,width:ow-x,});org.css({height:oh-y,"line-height":oh-y+"px",top:otop+y,width:ow-x,left:oleft+x});
self.options.onDrag&&self.options.onDrag(org,{height:oh-y,top:otop+y,width:ow-x,left:oleft+x})}else{if(semove){var x=e.pageX-ox;var y=e.pageY-oy;el.css({width:ow+x,height:oh+y});org.css({width:ow+x,height:oh+y,"line-height":oh+y+"px"});self.options.onDrag&&self.options.onDrag(org,{width:ow+x,height:oh+y})}else{if(swmove){var x=e.pageX-ox;var y=e.pageY-oy;el.css({width:ow-x,height:oh+y});org.css({width:ow-x,left:oleft+x,height:oh+y,"line-height":oh+y+"px"});self.options.onDrag&&self.options.onDrag(org,{width:ow-x,left:oleft+x,height:oh+y})}else{if(drag){var x=e.pageX-ox;var y=e.pageY-oy;org.css({left:oleft+x,top:otop+y});self.options.onDrag&&self.options.onDrag(org,{left:oleft+x,top:otop+y})}}}}}}}}}}).on("mouseup",function(e){emove=false;smove=false;wmove=false;nmove=false;nemove=false;nwmove=false;swmove=false;semove=false;drag=false})},bindTrigger:function(el){var self=this;el.on("click",function(e){e.stopPropagation();self.triggerResize(el)})},bindHidePanel:function(){var stage=this.options.stage;var itemClass=this.options.itemClass;var self=this;$(stage).on("click",function(){self.options.onHideItem&&self.options.onHideItem();$("."+itemClass).removeClass("item-show").children("div").css({display:"none"})})}};window.ZResize=ZResize})(jQuery);